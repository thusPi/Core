thusPiAssign("streams",{setup(){this.$container=$(".stream-editor"),this._setupComponents(),this._setupVariables(),this._setupInputs()},_setupInputs(){$('.stream-component-parameter:not([data-type="search"]):not(input)').each((function(){const t=$(this);t.attr("contenteditable",!0);let e=t.attr("data-stream-parameter-accept-type");e=isSet(e)?e.split(","):"string",e=Array.isArray(e)?e:[e];const a='.stream-variable[data-stream-variable-type="'+e.join('"], .stream-variable[data-stream-variable-type="')+'"]';t.droppable({tolerance:"touch",accept:a})})),$('.stream-component-parameter[data-type="search"]').each((function(){const t=$(this);t.data("input",new thusPi.ui.input.search(t));const e=t.attr("data-stream-input-values-index");if(!isSet(e))return!0;const a=thusPi.data.streams.values[e];if(!isSet(a))return!0;t.data("input").addResults(a)}))},_setupVariables(){$.each(thusPi.data.streams.variables,((t,e)=>{$.each(e,((e,a)=>{const r=thusPi.template.get(".stream-variable"),s=r.find(".stream-variable-content");s.html(a.content),r.find(".stream-variable-icon").html(thusPi.icon.create(a.icon)),r.attr("data-stream-variable-group",t),$.each(a.parameters,((t,e)=>{s.html(s.html().replace("%"+t,`<div class="stream-component-parameter-wrapper" data-stream-parameter-index="${t}"></div>`));const a=s.find(`> .stream-component-parameter-wrapper[data-stream-parameter-index="${t}"]`),r=thusPi.template.get('.stream-component-parameter[data-type="search"]');r.attr("data-stream-input-values-index",e.values_index),r.appendTo(a)})),r.appendTo(this.$container.find(".stream-variables-lol"))}))}))},_setupComponents(){$.each(thusPi.data.streams.components,((t,e)=>{const a=thusPi.template.get(".stream-component"),r=a.find("> .stream-component-content");a.find(".stream-component-title").text(e.title),r.html(e.content),isSet(e.parameters)&&$.each(e.parameters,(function(t,e){r.html(r.html().replace("%"+t,`<div class="stream-component-parameter-wrapper" data-stream-parameter-index="${t}"></div>`));const a=r.find(`> .stream-component-parameter-wrapper[data-stream-parameter-index="${t}"]`);let s;isSet(e.values_index)?(s=thusPi.template.get('.stream-component-parameter[data-type="search"]'),s.attr("data-stream-input-values-index",e.values_index)):s=thusPi.template.get(".stream-component-parameter:not([data-type])"),s.appendTo(a)})),a.appendTo(this.$container.find(".stream-components-lol"))}))}}),$(document).on("thuspi.ready",(function(){"streams/manage"==thusPi.page.current()&&thusPi.streams.setup()}));