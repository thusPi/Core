var requestingLogs=!1;function toggleLogCategory(t){setTimeout((function(){let t=getInactiveLogCategories();return $(".log-items").attr("data-hide-categories",t.join(",")),saveState("log_categories_inactive",t.join(","))}),1)}function getInactiveLogCategories(){let t=[];return $(".log-items-category-filter .btn:not(.active)").each((function(){t.push($(this).attr("data-category"))})),t}function requestMoreLogs(t=25,e=0){let o=$(".log-item").last(),n=parseInt(o.attr("data-index"))-1;n>=0&&requestLogs(n-amount,n)}async function refreshLogs(t=25){t=$(".log-item:not(#log-item-template)").slice(0,amount);let e=parseInt($(".log-item:not(#log-item-template)").first().attr("data-at"));if(newestAtMin>0){return requestLogs(t,e,"prepend")&&(throwSuccess("Succesfully refreshed top logs."),topItems.remove()),!1}}function refreshLogsLoop(){"admin/log/main"==thusPi.page.current()&&(refreshLogs(),setTimeout((function(){refreshLogsLoop()}),1500))}function requestLogs(t=25,e=0,o="prepend"){requestingLogs=!0,thusPi.api.call("logs-get",{top:t,min_time:e}).then((function(t){})).catch((function(){}))}function printLogMessage({at_readable:t,content:e,group:o,title:n}){const i=$(".log-items"),a=thusPi.template.get(".log-item"),s=$(`.btn[data-group="${o}"][data-color]`).attr("data-color")??"#000000";return a.find(".log-item-time").text(t),a.find(".log-item-title").text(n),a.find(".log-item-content").text(e+"."),a.attr({"data-group":o,"data-page-search":`${t} ${n}: ${e}.`,style:`--color: ${s}`}),a.appendTo(i),!0}function sortLogMessages(t,e){return t.index.toString().localeCompare(e.index.toString())}function sortLogMessagesInverted(t,e){return e.index.toString().localeCompare(t.index.toString())}document.addEventListener("scroll",(function(t){if("admin/log/main"!=thusPi.page.current())return;let e=t.target;if(e.classList.contains("log-items")){let t=e.scrollHeight,o=e.scrollTop;e.clientHeight;o>=.5*t&&!1===requestingLogs&&requestMoreLogs(),o>=t&&(e.scrollTop=o)}}),!0),thusPiAssign("admin.logs",{async fetch(t,e=0){const o=await thusPi.api.call("logs-get",{top:t,min_time:e});o.data.sort((function(t,e){return t.at<e.at?1:-1})),$.each(o.data,(function(t,e){printLogMessage(e)}))}}),$(document).on("thuspi.ready",(function(){"admin/log/main"==thusPi.page.current()&&thusPi.admin.logs.fetch(25)}));