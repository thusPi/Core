thusPiAssign("recordings.graph",{setup(t,i,s){this.$graph=t,this.recordingId=i,this.maxRows=s,this.curveSmoothing=0,this._fetchRows(void 0)},_fetchRows(t){thusPi.api.call("recordings/json",{id:this.recordingId,max_rows:this.maxRows}).then((t=>{this.rows=t.data.rows,this.size=t.data.size,this.manifest=t.data.manifest,this._paintRows()}))},_paintRows(){$(".graph-overlay").remove();let t="",i={};$.each(this.rows,((t,s)=>{$.each(s.y,((s,e)=>{if(0===t){const e=this._calculatePointCoordinates(t,s);return i[s]=`M ${e.x} ${e.y}`,!0}if(!isSet(i[s]))return!0;i[s]+=this._calculateBezierPath(t,s)}))})),$.each(i,((i,s)=>{t+=`<path d="${s.trim()}" stroke="${this.manifest.columns[`y${i}`].color||"red"}" fill="transparent"></path>`})),this.$graph.html(`<svg width="100%" height="100%" viewBox="0 0 1000 1000" preserveAspectRatio="none" xmlns="http://www.w3.org/2000/svg">${t}</svg>`)},_calculateLineProperties(t,i){const s=i.x-t.x,e=i.y-t.y;return{length:Math.sqrt(Math.pow(s,2)+Math.pow(e,2)),angle:Math.atan2(e,s)}},_calculateBezierPath(t,i){const s=[this._calculatePointCoordinates(t-2,i),this._calculatePointCoordinates(t-1,i),this._calculatePointCoordinates(t,i),this._calculatePointCoordinates(t+1,i)],e=this._calculateControlPoint(s[0],s[1],s[2]),a=this._calculateControlPoint(s[1],s[2],s[3],!0);return`C ${e.x},${e.y} ${a.x},${a.y} ${s[2].x},${s[2].y}`},_calculateControlPoint(t,i,s,e){t=t||i,s=s||i;const a=this._calculateLineProperties(t,s),o=a.angle+(e?Math.PI:0),r=a.length*this.curveSmoothing;return{x:i.x+Math.cos(o)*r,y:i.y+Math.sin(o)*r}},_calculatePointCoordinates(t,i){const s=this.rows[t];if(!isSet(s))return;const e=s.x;if(!isSet(e))return;const a=s.y[i];return isSet(a)?{x:(e-this.size.min_x)/this.size.dif_x*1e3,y:1e3-(a-this.size.min_y)/this.size.dif_y*1e3}:void 0}}),$(document).on("thuspi.ready",(function(){if("recordings/graph"!=thusPi.page.current())return!1;thusPi.recordings.graph.setup($(".graph"),urlParam("id"),500)}));