function moveRangeThumb(t,e,a=200){let s=t.parent(),i=t.siblings(".range-tooltip"),r=(s.outerWidth()-t.outerWidth())/(s.attr("data-max")||100)*e;t.parents(".device").attr("data-value",e),t.animate({left:r},a),i.text(e),i.animate({left:r+t.outerWidth()/2-i.outerWidth()/2},a)}homePi_assign("ui.input.search",class{constructor(t){this.$input=t,this.$wrapper=t.parents(".input-wrapper.input-wrapper-search").first(),this.$results=this.$wrapper.find(".input-search-results").first(),this.$wrapper.on("click",(t=>{t.stopPropagation()})),this.$input.on("click",(t=>{this.focusEvent(t)})),this.$input.on("input",(t=>{this.inputEvent(t)})),this.$input.on("change",(t=>{this.changeEvent(t)})),this.$results.on("click",".input-search-result",(t=>{this.resultFocusEvent(t)})),$(document).on("click",(t=>{this.focusOutEvent(t)}))}focusEvent(t){this.$wrapper.addClass("active"),this.resultsToggleAll(!0),this.resultsToggle(!0)}focusOutEvent(t){this.$wrapper.removeClass("active"),this.resultsToggle(!1)}inputEvent(t){t.preventDefault(),"change"!=this.$input.attr("filter-on")&&this.resultsFilter(this.$input.val())}changeEvent(t){t.preventDefault(),"change"==this.$input.attr("filter-on")&&this.resultsFilter(this.$input.val())}resultsToggle(t=!0){this.$results.toggleClass("show",t)}resultsToggleAll(t=!0){this.$results.find(".input-search-result[data-search-match]").toggleClass("show",t)}resultsFilter(t,e=!1){e||(t=t.toLowerCase()),this.$results.find(".input-search-result[data-search-match]").each((function(a,s){let i=$(s),r=i.attr("data-search-match");e||(r=r.toLowerCase()),i.toggleClass("show",r.includes(t))})),this.$results.attr("data-search-matches",this.$results.find(".input-search-result[data-search-match].show").length)}resultFocusEvent(t){let e=$(t.target).closest(".input-search-result"),a=e.attr("value"),s=e.attr("data-shown-value");if(this.$results.find(".input-search-result.active").removeClass("active"),e.addClass("active"),this.$wrapper.removeClass("active"),"multiple"!=this.$wrapper.attr("data-select-type")&&this.resultsToggle(!1),this.$input.value()==a)return!1;this.$input.value(a,s),this.$input.trigger("homepi.change")}}),$.fn.value=function(t,e){let a=this,s=a.get(0);return void 0===t?a.hasClass("input-search")?a.closest(".input-wrapper-search").attr("data-value"):void 0!==s.value?a.value:void 0!==a.attr("data-value")?a.attr("data-value"):"true"==a.attr("contenteditable")?a.text():void 0:(a.hasClass("input-search")?(a.closest(".input-wrapper-search").attr("data-value",t),a.closest("input").attr("value",e||t).val(e||t)):void 0!==s.value?a.value=t:void 0!==a.attr("data-value")?a.attr("data-value",t):"true"==a.attr("contenteditable")&&a.text(t),a)},$(document).on("click",'.input[data-type="checkbox"]',(function(){let t=$(this);"on"==t.attr("value")?t.attr("value","off"):t.attr("value","on")})),$(document).on("homepi.load",(function(){$(document).find('.input[data-type="range"]').each((function(){let t=$(this);0===t.children().length&&t.html('<div class="range-thumb"></div><div class="range-track"></div><div class="range-tooltip"></div>')})),$(document).find('.input[data-type="range"] .range-thumb').each((function(){let t=$(this),e=t.parent();numRange(e.attr("data-min")||0,e.attr("data-max")||1,e.attr("data-step")||1),moveRangeThumb(t,e.value()?e.value():parseFloat(e.attr("data-min")),0)})),$(document).find('.input[data-type="range"] .range-thumb').draggable({axis:"x",containment:"parent",drag:function(){let t=$(this),e=t.parent(),a=t.siblings(".range-tooltip"),s=numRange(e.attr("data-min")||0,e.attr("data-max")||100,e.attr("data-step")||1),i=Math.round((1.01*t.position().left+t.outerWidth()*Math.round(t.position().left/e.outerWidth()*10)/10)/e.outerWidth()*100*1e3)/1e3,r=closestArrayItem(i,s);a.text(r),a.css("left",t.position().left+t.outerWidth()/2-a.outerWidth()/2),e.attr("data-value",r),e.trigger("input")},stop:function(t,e){let a=$(this),s=a.parent(),i=a.siblings(".range-tooltip"),r=numRange(s.attr("data-min")||0,s.attr("data-max")||100,s.attr("data-step")||1),n=closestArrayItem(parseFloat(i.text()),r);s.attr("data-value",n),s.trigger("change")}})})),document.addEventListener("mousewheel",(function(t){let e=t.wheelDelta>0?"increase":"decrease";$('.input[data-type="range"]').each((function(){let a=$(this);if(!a.is(":hover")&&!a.is(":focus"))return!0;t.preventDefault();let s=a.find(".range-thumb"),i=a.value(),r=parseFloat(a.attr("data-min"))||0,n=parseFloat(a.attr("data-max"))||100,u=parseFloat(a.attr("data-step"))||1,l=i;return"decrease"==e?l=Math.max(i-u,r):"increase"==e&&(l=Math.min(i+u,n)),l!=i&&(moveRangeThumb(s,l,0),a.attr("data-value",l),a.trigger("input"),setTimeout((()=>{l==a.value()&&a.trigger("change")}),500)),!1}))}),{passive:!1}),$(document).on("click",'.input[data-type="range"]',(function(t){let e=$(this),a=e.find(".range-thumb"),s=(t.pageX-e.offset().left-a.outerWidth()/2)/e.outerWidth()*100,i=numRange(e.attr("data-min")||0,e.attr("data-max")||100,e.attr("data-step")||1),r=closestArrayItem(s,i);moveRangeThumb(a,r),e.attr("data-value",r),e.trigger("change")})),$(document).on("click",'.input[data-type="toggle"]',(function(){$(this).attr("data-value","on"==$(this).attr("data-value")?"off":"on").trigger("change")})),$(document).on("homepi.load",(function(){$(".input-wrapper-search input").each((function(){new homePi.ui.input.search($(this))}))}));));