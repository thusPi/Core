function moveRangeThumb(t,a,e=200){let s=t.parent(),i=t.siblings(".range-tooltip"),r=(s.outerWidth()-t.outerWidth())/(s.attr("data-max")||100)*a;t.parents(".device").attr("data-value",a),t.animate({left:r},e),i.text(a),i.animate({left:r+t.outerWidth()/2-i.outerWidth()/2},e)}thusPiAssign("ui.input.search",class{constructor(t){this.$input=t,this.$wrapper=t.parents(".input-wrapper.input-wrapper-search").first(),this.$results=this.$wrapper.find(".input-search-results").first(),this.$wrapper.on("click",(function(t){t.stopPropagation()})),this.$input.on("click",(t=>{this.focusEvent(t)})),this.$input.on("input",(t=>{this.inputEvent(t)})),this.$input.on("change",(t=>{this.changeEvent(t)})),this.$results.on("click",".input-search-result",(t=>{this.resultFocusEvent(t)})),$(document).on("click",(t=>{this.focusOutEvent(t)}))}focusEvent(t){this.$wrapper.addClass("active"),this.resultsToggleAll(!0),this.resultsToggle(!0)}focusOutEvent(t){this.$wrapper.removeClass("active"),this.resultsToggle(!1)}inputEvent(t){t.preventDefault(),"change"!=this.$input.attr("filter-on")&&this.resultsFilter(this.$input.val())}changeEvent(t){t.preventDefault(),"change"==this.$input.attr("filter-on")&&this.resultsFilter(this.$input.val())}resultsToggle(t=!0){this.$results.toggleClass("show",t)}resultsToggleAll(t=!0){this.$results.find(".input-search-result[data-search-match]").toggleClass("show",t)}resultsFilter(t,a=!1){a||(t=t.toLowerCase()),this.$results.find(".input-search-result[data-search-match]").each((function(e,s){let i=$(s),r=i.attr("data-search-match");a||(r=r.toLowerCase()),i.toggleClass("show",r.includes(t))})),this.$results.attr("data-search-matches",this.$results.find(".input-search-result[data-search-match].show").length)}resultFocusEvent(t){let a=$(t.target).closest(".input-search-result"),e=a.attr("value"),s=a.attr("data-shown-value");if(this.$results.find(".input-search-result.active").removeClass("active"),a.addClass("active"),this.$wrapper.removeClass("active"),"multiple"!=this.$wrapper.attr("data-select-type")&&this.resultsToggle(!1),this.$input.value()==e)return!1;this.$input.value(e,s),this.$input.trigger("thusPi.change")}}),$.fn.value=function(t,a){let e=this,s=e.get(0);return void 0===t?e.hasClass("input-search")?e.closest(".input-wrapper-search").attr("data-value"):void 0!==s.value?e.value:void 0!==e.attr("data-value")?e.attr("data-value"):"true"==e.attr("contenteditable")?e.text():void 0:(e.hasClass("input-search")?(e.closest(".input-wrapper-search").attr("data-value",t),e.closest("input").attr("value",a||t).val(a||t)):void 0!==s.value?e.value=t:void 0!==e.attr("data-value")?e.attr("data-value",t):"true"==e.attr("contenteditable")&&e.text(t),e)},$(document).on("click",'.input[data-type="checkbox"]',(function(){let t=$(this);"on"==t.attr("value")?t.attr("value","off"):t.attr("value","on")})),$(document).on("thusPi.load",(function(){$(document).find('.input[data-type="range"]').each((function(){let t=$(this);0===t.children().length&&t.html('<div class="range-thumb"></div><div class="range-track"></div><div class="range-tooltip"></div>')})),$(document).find('.input[data-type="range"] .range-thumb').each((function(){let t=$(this),a=t.parent();numRange(a.attr("data-min")||0,a.attr("data-max")||1,a.attr("data-step")||1);moveRangeThumb(t,a.value()?a.value():parseFloat(a.attr("data-min")),0)})),$(document).find('.input[data-type="range"] .range-thumb').draggable({axis:"x",containment:"parent",drag(){let t=$(this),a=t.parent(),e=t.siblings(".range-tooltip"),s=numRange(a.attr("data-min")||0,a.attr("data-max")||100,a.attr("data-step")||1),i=Math.round((1.01*t.position().left+t.outerWidth()*Math.round(t.position().left/a.outerWidth()*10)/10)/a.outerWidth()*100*1e3)/1e3,r=closestArrayItem(i,s);e.text(r),e.css("left",t.position().left+t.outerWidth()/2-e.outerWidth()/2),a.attr("data-value",r),a.trigger("input")},stop(t,a){let e=$(this),s=e.parent(),i=e.siblings(".range-tooltip"),r=numRange(s.attr("data-min")||0,s.attr("data-max")||100,s.attr("data-step")||1),n=closestArrayItem(parseFloat(i.text()),r);s.attr("data-value",n),s.trigger("change")}})})),document.addEventListener("mousewheel",(function(t){let a=t.wheelDelta>0?"increase":"decrease";$('.input[data-type="range"]').each((function(){let e=$(this);if(!e.is(":hover")&&!e.is(":focus"))return!0;t.preventDefault();let s=e.find(".range-thumb"),i=e.value(),r=parseFloat(e.attr("data-min"))||0,n=parseFloat(e.attr("data-max"))||100,u=parseFloat(e.attr("data-step"))||1,l=i;return"decrease"==a?l=Math.max(i-u,r):"increase"==a&&(l=Math.min(i+u,n)),l!=i&&(moveRangeThumb(s,l,0),e.attr("data-value",l),e.trigger("input"),setTimeout((function(){l==e.value()&&e.trigger("change")}),500)),!1}))}),{passive:!1}),$(document).on("click",'.input[data-type="range"]',(function(t){let a=$(this),e=a.find(".range-thumb"),s=(t.pageX-a.offset().left-e.outerWidth()/2)/a.outerWidth()*100,i=numRange(a.attr("data-min")||0,a.attr("data-max")||100,a.attr("data-step")||1),r=closestArrayItem(s,i);moveRangeThumb(e,r),a.attr("data-value",r),a.trigger("change")})),$(document).on("click",'.input[data-type="toggle"]',(function(){$(this).attr("data-value","on"==$(this).attr("data-value")?"off":"on").trigger("change")})),$(document).on("thusPi.load",(function(){$(".input-wrapper-search input").each((function(){$(this).data("input",new thusPi.ui.input.search($(this)))}))}));