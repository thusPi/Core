function moveRangeThumb(t,e,a=200){let s=t.parent(),i=t.siblings(".range-tooltip"),n=(s.outerWidth()-t.outerWidth())/(s.attr("data-max")||100)*e;t.parents(".device").attr("data-value",e),t.animate({left:n},a),i.text(e),i.animate({left:n+t.outerWidth()/2-i.outerWidth()/2},a)}thusPiAssign("ui.input.search",class{constructor(t){this.$input=t,"input"!=t.prop("nodeName").toLowerCase&&t.attr("contenteditable",!0),this.$input.wrap('<div class="input-wrapper input-wrapper-search"></div>'),this.$wrapper=t.parents(".input-wrapper.input-wrapper-search").first(),this.$wrapper.append('<ul class="input-search-results btn-column"></ul>'),this.$results=this.$wrapper.find(".input-search-results").first();const e=$(`ul.input-search-results[for="${this.$input.attr("name")}"]`).find(".input-search-result[value]");if(e.length>0){let t=[];e.each(((e,a)=>{const s=$(a),i=s.attr("value"),n=s.text().trim();t.push({value:i,description:s.attr("data-description"),text:n,href:s.attr("href"),onclick:s.attr("onclick"),match:s.attr("data-match"),iconHTML:s.attr("data-icon-html")}),isSet(s.attr("selected"))&&this.$input.value(i,n)})),this.addResults(t),e.remove()}this.$wrapper.on("click",(function(t){t.stopPropagation()})),this.$input.on("click",(t=>{this._clickEvent(t)})),this.$input.on("input",(t=>{this._inputEvent(t)})),this.$input.on("change",(t=>{this._changeEvent(t)})),this.$results.on("click",".input-search-result",(t=>{this._resultClickEvent(t)})),$(document).on("click",(t=>{this._clickOutEvent(t)}))}addResults(t){let e="";$.each(t,(function(t,a){if(!isSet(a.value))return!0;let s;a.text=a.text||a.value,a.match=a.match||a.text;const i=isSet(a.href)?"a":"li";isSet(a.description)||isSet(a.thumbnail)||isSet(a.iconHTML)?(s=$(`<${i} class="input-search-result input-search-result-rich btn bg-tertiary btn-secondary flex-row" value="${a.value}" data-match="${a.match}" data-shown-value="${a.text}"></${i}>`),s.append(`<span class="input-search-result-title">${a.text}</span>`),isSet(a.description)&&s.append(`<span class="input-search-result-description flex-row">${a.description}</span>`),isSet(a.thumbnail)?s.append(`<span class="input-search-result-thumbnail"><img src="${a.thumbnail}"></span>`):isSet(a.iconHTML)&&s.append(`<span class="input-search-result-thumbnail">${a.iconHTML}</span>`)):s=$(`<${i} class="input-search-result btn bg-tertiary btn-secondary" value="${a.value}" data-match="${a.match}" data-shown-value="${a.text}">${a.text}</${i}>`),isSet(a.href)&&s.attr("href",a.href),isSet(a.onclick)&&s.attr("onclick",a.onclick),isSet(a.match)&&s.attr("data-match",a.match),e+=s.prop("outerHTML")})),this.$results.append(e),this._resultsFilter(this.$input.val())}addResult(t){return this.addResults([t])}_clickEvent(t){$(".input-wrapper").removeClass("active"),$(".input-search-results").removeClass("show"),this.$input.focus(),this.$wrapper.addClass("active"),this._resultsToggleAll(!0),this._resultsToggle(!0)}_clickOutEvent(t){this.$wrapper.removeClass("active"),this._resultsToggle(!1)}_inputEvent(t){t.preventDefault(),"change"!=this.$input.attr("filter-on")&&this._resultsFilter(this.$input.val()||this.$input.text())}_changeEvent(t){t.preventDefault(),"change"==this.$input.attr("filter-on")&&this._resultsFilter(this.$input.val()||this.$input.text())}_resultsToggle(t=!0){this.$results.toggleClass("show",t)}_resultsToggleAll(t=!0){this.$results.find(".input-search-result[data-match]").toggleClass("show",t)}_resultsFilter(t,e=!1){e||(t=t.toLowerCase()),this.$results.find(".input-search-result[data-match]").each((function(a,s){let i=$(s),n=i.attr("data-match");e||(n=n.toLowerCase()),i.toggleClass("show",n.includes(t))})),this.$results.attr("data-search-matches",this.$results.find(".input-search-result[data-match].show").length)}_resultClickEvent(t){const e=$(t.target).closest(".input-search-result"),a=e.attr("value"),s=e.attr("data-shown-value");if(this.$results.find(".input-search-result.active").removeClass("active"),e.addClass("active"),this.$wrapper.removeClass("active"),"multiple"!=this.$wrapper.attr("data-select-type")&&this._resultsToggle(!1),!isSet(e.attr("href"))){if(this.$input.value()==a)return!1;this.$input.value(a,s),this.$input.trigger("thusPi.change")}}}),$.fn.value=function(t,e){const a=this,s=a.get(0);return e=e||t,void 0===t?"search"==a.attr("data-type")?a.attr("data-value"):void 0!==s.value?a.value:void 0!==a.attr("data-value")?a.attr("data-value"):"true"==a.attr("contenteditable")?a.text():void 0:("search"==a.attr("data-type")?(a.attr("data-value",t),"input"==a.prop("nodeName").toLowerCase()?a.attr("value",e).val(e):a.attr("value",e).text(e),a.siblings(".input-search-results").find(".input-search-result").removeClass("active"),a.siblings(".input-search-results").find(`.input-search-result[value="${t}"]`).addClass("active")):void 0!==s.value?a.value=t:void 0!==a.attr("data-value")?a.attr("data-value",t):"true"==a.attr("contenteditable")&&a.text(t),a)},$(document).on("click",'.input[data-type="checkbox"]',(function(){let t=$(this);"on"==t.attr("value")?t.attr("value","off"):t.attr("value","on")})),$(document).on("thuspi.load",(function(){$(document).find('.input[data-type="range"]').each((function(){let t=$(this);0===t.children().length&&t.html('<div class="range-thumb"></div><div class="range-track"></div><div class="range-tooltip"></div>')})),$(document).find('.input[data-type="range"] .range-thumb').each((function(){let t=$(this),e=t.parent();numRange(e.attr("data-min")||0,e.attr("data-max")||1,e.attr("data-step")||1);moveRangeThumb(t,e.value()?e.value():parseFloat(e.attr("data-min")),0)})),$(document).find('.input[data-type="range"] .range-thumb').draggable({axis:"x",containment:"parent",drag(){let t=$(this),e=t.parent(),a=t.siblings(".range-tooltip"),s=numRange(e.attr("data-min")||0,e.attr("data-max")||100,e.attr("data-step")||1),i=Math.round((1.01*t.position().left+t.outerWidth()*Math.round(t.position().left/e.outerWidth()*10)/10)/e.outerWidth()*100*1e3)/1e3,n=closestArrayItem(i,s);a.text(n),a.css("left",t.position().left+t.outerWidth()/2-a.outerWidth()/2),e.attr("data-value",n),e.trigger("input")},stop(t,e){let a=$(this),s=a.parent(),i=a.siblings(".range-tooltip"),n=numRange(s.attr("data-min")||0,s.attr("data-max")||100,s.attr("data-step")||1),r=closestArrayItem(parseFloat(i.text()),n);s.attr("data-value",r),s.trigger("change")}})})),$(document).on("click",'[contenteditable="true"]',(function(t){$(t.target).focus()})),document.addEventListener("mousewheel",(function(t){let e=t.wheelDelta>0?"increase":"decrease";$('.input[data-type="range"]').each((function(){let a=$(this);if(!a.is(":hover")&&!a.is(":focus"))return!0;t.preventDefault();let s=a.find(".range-thumb"),i=a.value(),n=parseFloat(a.attr("data-min"))||0,r=parseFloat(a.attr("data-max"))||100,u=parseFloat(a.attr("data-step"))||1,l=i;return"decrease"==e?l=Math.max(i-u,n):"increase"==e&&(l=Math.min(i+u,r)),l!=i&&(moveRangeThumb(s,l,0),a.attr("data-value",l),a.trigger("input"),setTimeout((function(){l==a.value()&&a.trigger("change")}),500)),!1}))}),{passive:!1}),$(document).on("click",'.input[data-type="range"]',(function(t){let e=$(this),a=e.find(".range-thumb"),s=(t.pageX-e.offset().left-a.outerWidth()/2)/e.outerWidth()*100,i=numRange(e.attr("data-min")||0,e.attr("data-max")||100,e.attr("data-step")||1),n=closestArrayItem(s,i);moveRangeThumb(a,n),e.attr("data-value",n),e.trigger("change")})),$(document).on("click",'.input[data-type="toggle"]',(function(){$(this).attr("data-value","on"==$(this).attr("data-value")?"off":"on").trigger("change")})),$(document).on("thuspi.load",(function(){$('input[data-type="search"]').each((function(){$(this).data("input",new thusPi.ui.input.search($(this)))}))}));