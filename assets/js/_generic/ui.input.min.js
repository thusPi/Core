function moveRangeThumb(t,a,e=200){let s=t.parent(),i=t.siblings(".range-tooltip"),n=(s.outerWidth()-t.outerWidth())/(s.attr("data-max")||100)*a;t.parents(".device").attr("data-value",a),t.animate({left:n},e),i.text(a),i.animate({left:n+t.outerWidth()/2-i.outerWidth()/2},e)}thusPiAssign("ui.input.search",class{constructor(t){this.$input=t,this.$input.wrap('<div class="input-wrapper input-wrapper-search"></div>'),this.$wrapper=t.parents(".input-wrapper.input-wrapper-search").first(),this.$wrapper.append('<ul class="input-search-results btn-column"></ul>'),this.$results=this.$wrapper.find(".input-search-results").first(),this.$wrapper.on("click",(function(t){t.stopPropagation()})),this.$input.on("click",(t=>{this._focusEvent(t)})),this.$input.on("input",(t=>{this._inputEvent(t)})),this.$input.on("change",(t=>{this._changeEvent(t)})),this.$results.on("click",".input-search-result",(t=>{this._resultFocusEvent(t)})),$(document).on("click",(t=>{this._focusOutEvent(t)}))}addResult(t){if(!isSet(t.value))return!1;t.shownValue=t.shownValue||t.value,t.match=t.match||t.shownValue;const a=isSet(t.href)?"a":"li";let e;isSet(t.description)||isSet(t.thumbnail)?(e=$(`<${a} class="input-search-result input-search-result-rich btn bg-tertiary btn-secondary" value="${t.value}" data-match="${t.match}"></${a}>`),e.append(`<span class="input-search-result-title">${t.shownValue}</span>`),isSet(t.description)&&e.append(`<span class="input-search-result-description flex-row">${t.description}</span>`),isSet(t.thumbnail)&&e.append(`<span class="input-search-result-thumbnail"><img src="${t.thumbnail}"></span>`)):e=$(`<${a} class="input-search-result btn bg-tertiary btn-secondary" value="${t.value}" data-match="${t.match}" data-shown-value="${t.shownValue}">${t.shownValue}</${a}>`),isSet(t.href)&&e.attr("href",t.href),this.$results.append(e),this._resultsFilter(this.$input.val())}_focusEvent(t){this.$wrapper.addClass("active"),this._resultsToggleAll(!0),this._resultsToggle(!0)}_focusOutEvent(t){this.$wrapper.removeClass("active"),this._resultsToggle(!1)}_inputEvent(t){t.preventDefault(),"change"!=this.$input.attr("filter-on")&&this._resultsFilter(this.$input.val())}_changeEvent(t){t.preventDefault(),"change"==this.$input.attr("filter-on")&&this._resultsFilter(this.$input.val())}_resultsToggle(t=!0){this.$results.toggleClass("show",t)}_resultsToggleAll(t=!0){this.$results.find(".input-search-result[data-match]").toggleClass("show",t)}_resultsFilter(t,a=!1){a||(t=t.toLowerCase()),this.$results.find(".input-search-result[data-match]").each((function(e,s){let i=$(s),n=i.attr("data-match");a||(n=n.toLowerCase()),i.toggleClass("show",n.includes(t))})),this.$results.attr("data-search-matches",this.$results.find(".input-search-result[data-match].show").length)}_resultFocusEvent(t){let a=$(t.target).closest(".input-search-result"),e=a.attr("value"),s=a.attr("data-shown-value");if(this.$results.find(".input-search-result.active").removeClass("active"),a.addClass("active"),this.$wrapper.removeClass("active"),"multiple"!=this.$wrapper.attr("data-select-type")&&this._resultsToggle(!1),!isSet(a.attr("href"))){if(this.$input.value()==e)return!1;this.$input.value(e,s),this.$input.trigger("thusPi.change")}}}),$.fn.value=function(t,a){const e=this,s=e.get(0);return a=a||t,void 0===t?"search"==e.attr("data-type")?e.attr("data-value"):void 0!==s.value?e.value:void 0!==e.attr("data-value")?e.attr("data-value"):"true"==e.attr("contenteditable")?e.text():void 0:("search"==e.attr("data-type")?(e.attr("data-value",t),e.attr("value",a).val(a)):void 0!==s.value?e.value=t:void 0!==e.attr("data-value")?e.attr("data-value",t):"true"==e.attr("contenteditable")&&e.text(t),e)},$(document).on("click",'.input[data-type="checkbox"]',(function(){let t=$(this);"on"==t.attr("value")?t.attr("value","off"):t.attr("value","on")})),$(document).on("thuspi.load",(function(){$(document).find('.input[data-type="range"]').each((function(){let t=$(this);0===t.children().length&&t.html('<div class="range-thumb"></div><div class="range-track"></div><div class="range-tooltip"></div>')})),$(document).find('.input[data-type="range"] .range-thumb').each((function(){let t=$(this),a=t.parent();numRange(a.attr("data-min")||0,a.attr("data-max")||1,a.attr("data-step")||1);moveRangeThumb(t,a.value()?a.value():parseFloat(a.attr("data-min")),0)})),$(document).find('.input[data-type="range"] .range-thumb').draggable({axis:"x",containment:"parent",drag(){let t=$(this),a=t.parent(),e=t.siblings(".range-tooltip"),s=numRange(a.attr("data-min")||0,a.attr("data-max")||100,a.attr("data-step")||1),i=Math.round((1.01*t.position().left+t.outerWidth()*Math.round(t.position().left/a.outerWidth()*10)/10)/a.outerWidth()*100*1e3)/1e3,n=closestArrayItem(i,s);e.text(n),e.css("left",t.position().left+t.outerWidth()/2-e.outerWidth()/2),a.attr("data-value",n),a.trigger("input")},stop(t,a){let e=$(this),s=e.parent(),i=e.siblings(".range-tooltip"),n=numRange(s.attr("data-min")||0,s.attr("data-max")||100,s.attr("data-step")||1),r=closestArrayItem(parseFloat(i.text()),n);s.attr("data-value",r),s.trigger("change")}})})),document.addEventListener("mousewheel",(function(t){let a=t.wheelDelta>0?"increase":"decrease";$('.input[data-type="range"]').each((function(){let e=$(this);if(!e.is(":hover")&&!e.is(":focus"))return!0;t.preventDefault();let s=e.find(".range-thumb"),i=e.value(),n=parseFloat(e.attr("data-min"))||0,r=parseFloat(e.attr("data-max"))||100,u=parseFloat(e.attr("data-step"))||1,l=i;return"decrease"==a?l=Math.max(i-u,n):"increase"==a&&(l=Math.min(i+u,r)),l!=i&&(moveRangeThumb(s,l,0),e.attr("data-value",l),e.trigger("input"),setTimeout((function(){l==e.value()&&e.trigger("change")}),500)),!1}))}),{passive:!1}),$(document).on("click",'.input[data-type="range"]',(function(t){let a=$(this),e=a.find(".range-thumb"),s=(t.pageX-a.offset().left-e.outerWidth()/2)/a.outerWidth()*100,i=numRange(a.attr("data-min")||0,a.attr("data-max")||100,a.attr("data-step")||1),n=closestArrayItem(s,i);moveRangeThumb(e,n),a.attr("data-value",n),a.trigger("change")})),$(document).on("click",'.input[data-type="toggle"]',(function(){$(this).attr("data-value","on"==$(this).attr("data-value")?"off":"on").trigger("change")})),$(document).on("thuspi.load",(function(){$('input[data-type="search"]').each((function(){$(this).data("input",new thusPi.ui.input.search($(this)))}))}));